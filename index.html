<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flappy Ball - ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³</title>
  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Tahoma', sans-serif;
    }
    body {
      background: #111;
      color: #fff;
      text-align: center;
      user-select: none;
      touch-action: none; /* Ù…Ù‡Ù… Ù„Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
    }
    canvas {
      background: linear-gradient(135deg, #1e1e1e 0%, #121212 100%);
      display: block;
      margin: 20px auto;
      border: 3px solid #00ffd5;
      border-radius: 12px;
      box-shadow: 0 0 15px #00ffd5;
      touch-action: none; /* Ù…Ù‡Ù… */
    }
    .screen {
      display: none;
      padding: 20px;
    }
    .screen.active {
      display: block;
    }
    input {
      padding: 10px;
      margin: 10px auto;
      width: 200px;
      font-size: 16px;
      border-radius: 6px;
      border: 1.5px solid #00ffd5;
      background: #222;
      color: #0ff;
      text-align: center;
      outline: none;
      transition: 0.3s;
    }
    input:focus {
      border-color: #00ffab;
      box-shadow: 0 0 6px #00ffab;
    }
    button {
      padding: 12px 25px;
      font-size: 18px;
      margin: 10px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background: #00ffd5;
      color: #000;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background: #00ffab;
    }
    #coinsDisplay {
      font-size: 20px;
      margin-top: 10px;
      color: #0ff;
    }
    #storeItems {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 15px;
    }
    .store-item {
      background: #222;
      padding: 12px;
      border-radius: 10px;
      width: 110px;
      color: #0ff;
      box-shadow: 0 0 8px #00ffd5aa;
      user-select: none;
    }
    .store-item div {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-bottom: 8px;
      filter: drop-shadow(0 0 3px #00ffd5);
    }
    .store-item button {
      width: 100%;
      margin-top: 6px;
      background: #008f7f;
      color: #0ff;
      font-weight: bold;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    .store-item button:hover {
      background: #00ffd5;
      color: #000;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas" width="360" height="480"></canvas>

<div id="startScreen" class="screen active">
  <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Flappy Ball</h2>
  <input type="text" id="playerName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" maxlength="15" />
  <div id="coinsDisplay">ğŸ’° 0</div>
  <button onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
  <button onclick="openStore()">Ø§Ù„Ù…ØªØ¬Ø±</button>
  <p>Ø­Ø±Ùƒ Ø§Ù„ÙƒØ±Ø© Ø¨Ø§Ù„Ø³Ø­Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©</p>
</div>

<div id="gameOverScreen" class="screen">
  <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
  <p>Ù†ØªÙŠØ¬ØªÙƒ: <span id="finalScore"></span></p>
  <p>Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©: <span id="bestScore"></span></p>
  <button onclick="restartGame()">Ø¥Ø¹Ø§Ø¯Ø©</button>
</div>

<div id="storeScreen" class="screen">
  <h2>Ø§Ù„Ù…ØªØ¬Ø±</h2>
  <p>ğŸ’° <span id="storeCoins">0</span></p>
  <div id="storeItems"></div>
  <button onclick="closeStore()">Ø±Ø¬ÙˆØ¹</button>
</div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const startScreen = document.getElementById("startScreen");
  const gameOverScreen = document.getElementById("gameOverScreen");
  const storeScreen = document.getElementById("storeScreen");
  const finalScoreDisplay = document.getElementById("finalScore");
  const bestScoreDisplay = document.getElementById("bestScore");
  const coinsDisplay = document.getElementById("coinsDisplay");
  const storeCoins = document.getElementById("storeCoins");
  const storeItems = document.getElementById("storeItems");
  const playerNameInput = document.getElementById("playerName");

  let gameStarted = false;
  let score = 0;
  let bestScore = parseInt(localStorage.getItem("bestScore")) || 0;
  let coins = parseInt(localStorage.getItem("coins")) || 0;
  let selectedCharacter = 0;
  let ownedCharacters = JSON.parse(localStorage.getItem("ownedCharacters")) || [0];
  let pipes = [];
  let frame = 0;
  let pipeSpeed = 2;
  let lives = 5;

  // Ø§Ù„ÙƒØ±Ø© = Ø§Ù„Ø´Ø®ØµÙŠØ© (Ø¯Ø§Ø¦Ø±Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ØµÙˆØ±Ø© Ø·ÙŠØ±)
  const ball = {
    x: 60,
    y: 240,
    radius: 20,
    color: "#00ffd5",
    draw: function () {
      ctx.beginPath();
      ctx.fillStyle = this.color;
      ctx.shadowColor = this.color;
      ctx.shadowBlur = 12;
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.closePath();
    }
  };

  function createPipe() {
    let topHeight = Math.floor(Math.random() * 180) + 50;
    pipes.push({ x: canvas.width, topHeight });
  }

  function updatePipes() {
    for (let i = 0; i < pipes.length; i++) {
      let p = pipes[i];
      p.x -= pipeSpeed;

      // Ø£Ù†Ø§Ø¨ÙŠØ¨ (Ù…Ø³ØªØ·ÙŠÙ„Ø§Øª)
      ctx.fillStyle = "#00bb44";
      ctx.shadowColor = "#00bb44";
      ctx.shadowBlur = 8;
      ctx.fillRect(p.x, 0, 50, p.topHeight);
      ctx.fillRect(p.x, p.topHeight + 120, 50, canvas.height - p.topHeight - 120);

      // ØªØµØ§Ø¯Ù… Ø§Ù„ÙƒØ±Ø© Ù…Ø¹ Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨
      if (
        ball.x + ball.radius > p.x &&
        ball.x - ball.radius < p.x + 50 &&
        (ball.y - ball.radius < p.topHeight || ball.y + ball.radius > p.topHeight + 120)
      ) {
        loseLife();
        pipes.splice(i, 1);
        i--;
      }

      // Ù†Ù‚Ø·Ø© Ø¹Ù†Ø¯ Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨
      if (p.x + 50 === ball.x - ball.radius) {
        score++;
        coins++;
        if (score % 5 === 0) pipeSpeed += 0.3;
      }
    }

    pipes = pipes.filter(p => p.x + 50 > 0);
  }

  function drawBackground() {
    // Ø®Ù„ÙÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ù…Ù…ÙˆÙ‘Ø¬Ø©
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, "#001010");
    gradient.addColorStop(1, "#003333");
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  function drawScore() {
    ctx.fillStyle = "#00ffd5";
    ctx.font = "20px Tahoma";
    ctx.textAlign = "left";
    ctx.fillText("Ø§Ù„Ù†Ù‚Ø§Ø·: " + score, 10, 30);
    ctx.fillText("Ø§Ù„Ø¹Ù…Ù„Ø§Øª: " + coins, 10, 60);
    ctx.fillText("â¤ï¸: " + lives, 10, 90);
  }

  function gameLoop() {
    if (!gameStarted) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBackground();
    ball.draw();
    if (frame % 90 === 0) createPipe();
    updatePipes();
    drawScore();
    frame++;
    requestAnimationFrame(gameLoop);
  }

  function loseLife() {
    lives--;
    if (lives <= 0) {
      endGame();
    } else {
      // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙƒØ±Ø© Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
      ball.x = 60;
      ball.y = canvas.height / 2;
    }
  }

  function startGame() {
    const playerName = playerNameInput.value.trim();
    if (!playerName) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹");

    score = 0;
    lives = 5;
    pipes = [];
    frame = 0;
    pipeSpeed = 2;
    coins = parseInt(localStorage.getItem("coins")) || 0;
    ball.x = 60;
    ball.y = canvas.height / 2;
    gameStarted = true;
    switchScreen(null);
    updateDisplays();
    requestAnimationFrame(gameLoop);
  }

  function endGame() {
    gameStarted = false;
    finalScoreDisplay.innerText = score;
    bestScore = Math.max(bestScore, score);
    localStorage.setItem("bestScore", bestScore);
    localStorage.setItem("coins", coins);
    bestScoreDisplay.innerText = bestScore;
    switchScreen(gameOverScreen);
  }

  function restartGame() {
    switchScreen(startScreen);
  }

  function switchScreen(target) {
    [startScreen, gameOverScreen, storeScreen].forEach(s => s.classList.remove("active"));
    if (target) target.classList.add("active");
    updateDisplays();
  }

  function updateDisplays() {
    coinsDisplay.innerText = `ğŸ’° ${coins}`;
    storeCoins.innerText = coins;
  }

  // Ø§Ù„Ù…ØªØ¬Ø± - Ø´ÙƒÙ„ Ø¨Ø³ÙŠØ· Ù„Ø´Ø±Ø§Ø¡ Ø£Ù„ÙˆØ§Ù† Ù„Ù„ÙƒØ±Ø© (Ø´Ø®ØµÙŠØ§Øª)
  const colors = [
    "#00ffd5", "#ff4c4c", "#ffd500", "#4cff4c", "#4c6cff",
    "#ff4cff", "#ff804c", "#00ffff", "#ff00ff", "#ffff00"
  ];

  function openStore() {
    storeItems.innerHTML = "";
    for (let i = 0; i < colors.length; i++) {
      const price = (i + 1) * 10;
      const owned = ownedCharacters.includes(i);
      const item = document.createElement("div");
      item.className = "store-item";
      item.innerHTML = `
        <div style="background:${colors[i]}"></div>
        ${owned ? "âœ… Ù…Ù…Ù„ÙˆÙƒ" : `ğŸª™ ${price}`}
        <button ${owned ? "disabled" : ""} onclick="buyCharacter(${i}, ${price})">
          Ø´Ø±Ø§Ø¡
        </button>
      `;
      storeItems.appendChild(item);
    }
    switchScreen(storeScreen);
  }

  function buyCharacter(index, price) {
    if (coins >= price && !ownedCharacters.includes(index)) {
      coins -= price;
      ownedCharacters.push(index);
      localStorage.setItem("coins", coins);
      localStorage.setItem("ownedCharacters", JSON.stringify(ownedCharacters));
      updateDisplays();
      openStore();
    } else {
      alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Øª ÙƒØ§ÙÙŠØ©");
    }
  }

  // ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ - Ø§Ù„Ø³Ø­Ø¨ Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ±Ø©
  let isDragging = false;
  let dragOffsetX = 0;
  let dragOffsetY = 0;

  canvas.addEventListener("touchstart", (e) => {
    e.preventDefault();
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    const touchX = touch.clientX - rect.left;
    const touchY = touch.clientY - rect.top;
    const dx = touchX - ball.x;
    const dy = touchY - ball.y;
    if (Math.sqrt(dx * dx + dy * dy) < ball.radius + 10) { // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø·
      isDragging = true;
      dragOffsetX = dx;
      dragOffsetY = dy;
    }
  });

  canvas.addEventListener("touchmove", (e) => {
    e.preventDefault();
    if (!isDragging) return;
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    let newX = touch.clientX - rect.left - dragOffsetX;
    let newY = touch.clientY - rect.top - dragOffsetY;

    // Ø­Ø¯ÙˆØ¯ ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ÙˆØ­Ø©
    newX = Math.max(ball.radius, Math.min(canvas.width - ball.radius, newX));
    newY = Math.max(ball.radius, Math.min(canvas.height - ball.radius, newY));

    ball.x = newX;
    ball.y = newY;
  });

  canvas.addEventListener("touchend", (e) => {
    e.preventDefault();
    isDragging = false;
  });

  // Ù„Ù…Ù†ØµØ© Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨ (ÙØ£Ø±Ø©)
  canvas.addEventListener("mousedown", (e) => {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;
    const dx = mouseX - ball.x;
    const dy = mouseY - ball.y;
    if (Math.sqrt(dx * dx + dy * dy) < ball.radius + 10) {
      isDragging = true;
      dragOffsetX = dx;
      dragOffsetY = dy;
    }
  });

  canvas.addEventListener("mousemove", (e) => {
    e.preventDefault();
    if (!isDragging) return;
    const rect = canvas.getBoundingClientRect();
    let newX = e.clientX - rect.left - dragOffsetX;
    let newY = e.clientY - rect.top - dragOffsetY;

    newX = Math.max(ball.radius, Math.min(canvas.width - ball.radius, newX));
    newY = Math.max(ball.radius, Math.min(canvas.height - ball.radius, newY));

    ball.x = newX;
    ball.y = newY;
  });

  canvas.addEventListener("mouseup", (e) => {
    e.preventDefault();
    isDragging = false;
  });

  canvas.addEventListener("mouseleave", (e) => {
    e.preventDefault();
    isDragging = false;
  });

</script>
</body>
</html>